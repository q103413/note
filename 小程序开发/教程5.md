# 微信小程序开发入门到实战：从零打造你的第一个小程序

微信小程序凭借其 “无需下载、即用即走” 的特性，已成为连接线上线下、服务用户的重要载体。本教程将带你从环境搭建开始，逐步掌握小程序开发的核心技能，并通过一个实战案例，让你能够独立开发并上线自己的小程序。

本教程适合具备一定 HTML、CSS、JavaScript 基础的开发者。

------

## 一、开发环境准备

在开始编写代码之前，我们需要先搭建好必要的开发环境。

### 1. 安装微信开发者工具

这是官方提供的唯一集成开发环境（IDE），集代码编辑、编译、调试、预览、发布于一体。

- **下载地址**：[微信开发者工具官网](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
- **安装步骤**：根据你的操作系统（Windows/macOS）下载对应的安装包，然后按照默认提示进行安装。

### 2. 注册小程序账号并获取 AppID

要开发和发布小程序，你需要一个小程序账号。

1. **访问微信公众平台**：打开 https://mp.weixin.qq.com/，点击右上角的 “立即注册”。
2. **选择账号类型**：选择 “小程序”。
3. **填写注册信息**：按照提示填写邮箱、密码、验证码，并完成实名认证（个人开发者需绑定银行卡，企业开发者需上传营业执照）。
4. **获取 AppID**：
   - 注册并登录后，进入 “开发管理” -> “开发设置” 页面。
   - 在页面中找到 “AppID (小程序 ID)”，这是你小程序的唯一标识，后续项目配置会用到。**请务必使用自己的 AppID，而不是测试号**，这样才能体验完整的功能并发布上线。

------

## 二、创建第一个小程序项目

现在，让我们动手创建一个新项目，来熟悉小程序的项目结构。

1. **打开微信开发者工具**，选择 “小程序” 模板，点击 “+” 号创建新项目。
2. **填写项目信息**：
   - **项目名称**：例如 `MyFirstMiniProgram`。
   - **目录**：选择一个空的文件夹作为项目根目录。
   - **AppID**：粘贴你刚刚获取的 AppID。
   - **勾选 "云开发"**：暂时不勾选，我们先从基础的原生开发开始。
   - **点击 “创建”**。

### 小程序项目结构解析

创建成功后，你会看到如下的项目目录结构，这是小程序的标准结构：

```plaintext
├── pages/                     # 所有页面存放目录
│   ├── index/                 # 首页
│   │   ├── index.js           # 首页的逻辑层
│   │   ├── index.json         # 首页的配置文件
│   │   ├── index.wxml         # 首页的视图层
│   │   └── index.wxss         # 首页的样式文件
│   └── logs/                  # 日志页（默认生成）
│       ├── logs.js
│       ├── logs.json
│       ├── logs.wxml
│       └── logs.wxss
├── utils/                     # 通用工具函数目录
│   └── util.js
├── app.js                     # 小程序全局逻辑文件
├── app.json                   # 小程序全局配置文件
└── app.wxss                   # 小程序全局样式文件
```

**核心文件说明**：

- **`.json` 文件**：用于配置。`app.json` 是全局配置，决定页面文件的路径、窗口表现等。页面级别的 `.json` 文件用于配置当前页面的窗口样式，会覆盖全局配置。
- **`.wxml` 文件**：WeiXin Markup Language，用于描述页面的结构，类似 HTML。
- **`.wxss` 文件**：WeiXin Style Sheet，用于描述页面的样式，类似 CSS。它扩展了 `rpx` 单位，可自动适配不同屏幕。
- **`.js` 文件**：用于处理页面的逻辑，比如数据处理、事件绑定等。

------

## 三、核心语法与概念

### 1. 数据绑定 (WXML & JS)

小程序采用数据驱动视图的模式。你需要在 `.js` 文件的 `data` 对象中定义数据，然后在 `.wxml` 文件中使用 `{{ }}` 语法来绑定数据。

**示例 (`pages/index/index.js`)**：

```javascript
Page({
  data: {
    message: 'Hello, 小程序!',
    userInfo: {
      name: '张三',
      avatar: '/images/avatar.png'
    }
  }
})
```

**示例 (`pages/index/index.wxml`)**：

```xml
<view class="container">
  <!-- 绑定简单数据 -->
  <text>{{ message }}</text>

  <!-- 绑定对象属性 -->
  <view>用户名: {{ userInfo.name }}</view>
  
  <!-- 绑定并进行简单运算 -->
  <view> {{ 10 + 20 }} </view>
</view>
```

### 2. 事件处理

用户的交互（如点击按钮）会触发事件，你需要在 `.js` 中定义事件处理函数来响应。

**示例 (`pages/index/index.wxml`)**：

```xml
<!-- bindtap 绑定一个点击事件 -->
<button bindtap="handleClick">点击我</button>
<view>点击次数: {{ count }}</view>
```

**示例 (`pages/index/index.js`)**：

```javascript
Page({
  data: {
    count: 0
  },

  // 定义事件处理函数
  handleClick: function() {
    console.log('按钮被点击了');
    
    // 使用 this.setData() 来修改数据，页面会自动更新
    this.setData({
      count: this.data.count + 1
    })
  }
})
```

**注意**：修改数据必须使用 `this.setData()`，而不能直接 `this.data.count = 1`，这样才能触发视图的重新渲染。

### 3. 页面跳转

小程序中页面跳转是常见操作，使用 `wx.navigateTo` 或 `wx.switchTab` 等 API。

**示例 (`pages/index/index.js`)**：

```javascript
// 在 handleClick 函数中添加跳转逻辑
handleClick: function() {
  // 跳转到 logs 页面
  wx.navigateTo({
    url: '/pages/logs/logs'
  })
}
```

`wx.navigateTo` 会保留当前页面，而 `wx.switchTab` 用于跳转到 `tabBar` 页面，并关闭其他所有非 `tabBar` 页面。

------

## 四、实战：开发一个 "今日天气" 小程序

理论知识讲完了，现在我们来动手开发一个简单但实用的小程序，它能获取并显示当前城市的天气。

### 功能规划

1. 首页显示一个城市名称和 “获取天气” 按钮。
2. 用户点击按钮后，调用天气 API 获取数据。
3. 在页面上展示获取到的天气信息（温度、天气状况等）。

### 步骤 1: 获取天气 API

我们将使用 [和风天气 API](https://dev.qweather.com/)，它提供免费的接口。

1. 注册并登录和风天气开发者平台。
2. 进入 “应用管理”，创建一个新应用，获取你的 API Key。

### 步骤 2: 编写代码

#### 1. 配置页面路由 (`app.json`)

确保 `pages` 数组中包含了 `index` 页面。

```json
{
  "pages": [
    "pages/index/index",
    "pages/logs/logs"
  ],
  "window": {
    "backgroundTextStyle": "light",
    "navigationBarBackgroundColor": "#fff",
    "navigationBarTitleText": "今日天气",
    "navigationBarTextStyle": "black"
  },
  "style": "v2",
  "sitemapLocation": "sitemap.json"
}
```

#### 2. 设计页面结构 (`pages/index/index.wxml`)

```xml
<view class="container">
  <view class="city">城市: {{ city }}</view>
  
  <button bindtap="getWeather">获取天气</button>

  <view wx:if="{{ weather }}" class="weather-card">
    <view class="temp">当前温度: {{ weather.temp }}°C</view>
    <view class="condition">天气状况: {{ weather.cond_txt }}</view>
    <view class="humidity">湿度: {{ weather.hum }}%</view>
  </view>
</view>
```

`wx:if` 用于条件渲染，只有当 `weather` 数据存在时，才显示天气卡片。

#### 3. 添加页面样式 (`pages/index/index.wxss`)

```css
.container {
  padding: 40rpx;
  font-family: sans-serif;
}

.city {
  font-size: 36rpx;
  text-align: center;
  margin-bottom: 50rpx;
}

button {
  width: 80%;
  margin: 0 auto;
  display: block;
  background-color: #07c160;
  color: #fff;
}

.weather-card {
  margin-top: 50rpx;
  padding: 40rpx;
  border: 1rpx solid #eee;
  border-radius: 16rpx;
  background-color: #f9f9f9;
}

.weather-card view {
  font-size: 30rpx;
  margin-bottom: 20rpx;
}

.temp {
  color: #ff7300;
  font-size: 36rpx;
  font-weight: bold;
}
```

#### 4. 编写核心逻辑 (`pages/index/index.js`)

```javascript
Page({
  data: {
    city: '北京',
    weather: null // 用于存储天气数据
  },

  getWeather: function() {
    const that = this; // 在回调函数中，this 指向会改变，提前保存

    // 显示加载提示
    wx.showLoading({
      title: '正在获取天气...',
    });

    // 调用和风天气 API
    wx.request({
      url: 'nx6r6xvfhh.re.qweatherapi.com/v7/weather/now',
      data: {
        location: that.data.city, // 城市名
        key: 'Q1A46C9040' // 替换成你自己的 API Key
      },
      success(res) {
        console.log(res.data);
        if (res.data.HeWeather6[0].status === 'ok') {
          const now = res.data.HeWeather6[0].now;
          that.setData({
            weather: {
              temp: now.tmp,
              cond_txt: now.cond_txt,
              hum: now.hum
            }
          });
        } else {
          wx.showToast({
            title: '获取天气失败',
            icon: 'none'
          });
        }
      },
      fail() {
        wx.showToast({
          title: '网络请求失败',
          icon: 'none'
        });
      },
      complete() {
        // 无论成功失败，都关闭加载提示
        wx.hideLoading();
      }
    })
  }
})
```

**重要**：将代码中的 `'你的和风天气API Key'` 替换为你自己的 API Key。

### 步骤 3: 预览与调试

1. 点击开发者工具左侧栏的 “模拟器”，你可以看到小程序的实时预览效果。
2. 点击 “获取天气” 按钮，数据应该会成功加载并显示在界面上。
3. 如果遇到问题，可以查看右侧的 “调试器” 面板：
   - **Console**：查看 `console.log` 输出和错误信息。
   - **Network**：查看 `wx.request` 的网络请求详情，包括请求头、响应数据等，这是调试 API 的利器。

------

## 五、发布上线

当你完成开发并测试无误后，就可以将它发布到微信平台，供所有用户使用了。

1. **上传代码**：
   - 点击开发者工具右上角的 “上传” 按钮。
   - 填写**版本号**（如 `1.0.0`）和**项目备注**（如 “初始版本”）。
   - 点击 “上传”。
2. **提交审核**：
   - 登录 [微信公众平台](https://mp.weixin.qq.com/)。
   - 进入 “版本管理” -> “开发版本”。
   - 你会看到刚刚上传的版本，点击右侧的 “提交审核”。
   - 填写审核信息，如小程序类目、功能说明，并上传几张小程序的截图。
   - 提交后，等待微信团队审核，通常需要 1-3 个工作日。
3. **发布**：
   - 审核通过后，该版本会自动进入 “审核通过” 列表。
   - 点击 “发布” 按钮，你的小程序就正式上线了！用户可以在微信中搜索到它。

------

## 六、总结与进阶

恭喜你！通过本教程，你已经掌握了微信小程序开发的基本流程和核心技术，并成功发布了一个自己的作品。

### 常见问题 (FAQ)

- **`wx.request` 域名不合法？**
  - **原因**：小程序为了安全，要求所有网络请求的域名都必须在后台添加到白名单中。
  - **解决**：在微信公众平台，进入 “开发” -> “开发设置” -> “服务器域名”，将你的 API 域名（如 `free-api.heweather.net`）添加到 `request` 合法域名列表中。**本地开发时**，可以在开发者工具的 “详情” -> “本地设置” 中，勾选 “不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书” 来跳过检查。

### 进阶学习方向

- **组件化开发**：学习使用 `Component` 构造器创建可复用的自定义组件。
- **云开发**：无需搭建服务器，使用小程序云开发提供的数据库、存储、云函数等能力，快速实现后端功能。
- **第三方 UI 组件库**：如 Vant Weapp、iView Weapp，可以极大地提高你的开发效率。
- **小程序支付、地图、登录**等高级 API 的使用。

小程序生态一直在发展，持续关注 [微信小程序官方文档](https://developers.weixin.qq.com/miniprogram/dev/framework/) 是保持进步的最佳方式。祝你在小程序开发的道路上越走越远