æ‚¨å¥½ï¼Œåœ¨ Linux ç³»ç»Ÿä¸Šå¯åŠ¨ Java JAR åŒ…é€šå¸¸æœ‰å‡ ç§æ–¹æ³•ï¼Œå…·ä½“å–å†³äºæ‚¨å¸Œæœ›å®ƒåœ¨å‰å°è¿è¡Œè¿˜æ˜¯åœ¨åå°è¿è¡Œï¼Œä»¥åŠæ˜¯å¦å¸Œæœ›å®ƒåœ¨æ‚¨æ–­å¼€ SSH è¿æ¥åç»§ç»­è¿è¡Œã€‚

ä»¥ä¸‹æ˜¯ DevOps å’Œè¿ç»´å·¥ç¨‹å¸ˆå¸¸ç”¨çš„å¯åŠ¨ JAR åŒ…çš„æ•™ç¨‹åŠå‘½ä»¤ï¼š

------

## ğŸ’» Linux å¯åŠ¨ Java JAR åŒ…æ•™ç¨‹

### æ–¹å¼ä¸€ï¼šåŸºç¡€å‰å°å¯åŠ¨

è¿™æ˜¯æœ€ç®€å•çš„å¯åŠ¨æ–¹å¼ï¼Œä½†ä¸€æ—¦æ‚¨å…³é—­ç»ˆç«¯æˆ–æŒ‰ä¸‹ `Ctrl+C`ï¼Œç¨‹åºå°±ä¼šåœæ­¢ã€‚

- **å‘½ä»¤ï¼š**

  Bash

  ```
  java -jar your_application.jar
  ```

- **æ³¨è§£ï¼š** é€‚ç”¨äºè°ƒè¯•ã€å¿«é€Ÿæµ‹è¯•æˆ–éœ€è¦ç«‹å³åœæ­¢çš„åº”ç”¨ã€‚

### æ–¹å¼äºŒï¼šåå°è¿è¡Œå¹¶é˜²æ­¢ç»ˆç«¯å…³é—­ (æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒ)

åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œåº”ç”¨å¿…é¡»æŒç»­è¿è¡Œï¼Œå³ä½¿ SSH ä¼šè¯æ–­å¼€ã€‚è¿™é€šå¸¸ä½¿ç”¨ `nohup` å‘½ä»¤é…åˆ `&` ç¬¦å·å®ç°ã€‚

#### 1. ä½¿ç”¨ `nohup`

`nohup` (No Hang Up) å¯ä»¥ä½¿ç¨‹åºå¿½ç•¥ SIGHUP ä¿¡å·ï¼Œä»è€Œåœ¨ç»ˆç«¯å…³é—­åç»§ç»­è¿è¡Œã€‚

- **å‘½ä»¤ï¼š**

  Bash

  ```
  nohup java -jar your_application.jar > app.log 2>&1 &
  ```

- **æ³¨è§£ï¼š**

  - `nohup ... &`: ä½¿ç¨‹åºåœ¨åå°è¿è¡Œã€‚
  - `> app.log`: å°†ç¨‹åºçš„æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰é‡å®šå‘åˆ° `app.log` æ–‡ä»¶ã€‚
  - `2>&1`: å°†ç¨‹åºçš„æ ‡å‡†é”™è¯¯è¾“å‡ºï¼ˆstderrï¼Œæ–‡ä»¶æè¿°ç¬¦ 2ï¼‰é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºï¼ˆæ–‡ä»¶æè¿°ç¬¦ 1ï¼‰çš„æŒ‡å‘ä½ç½®ï¼Œå³ä¹Ÿå†™å…¥ `app.log`ã€‚
  - **ä¼˜ç‚¹ï¼š** ç®€å•å¯é ï¼Œæ—¥å¿—é›†ä¸­åœ¨æŒ‡å®šæ–‡ä»¶ã€‚

#### 2. ä½¿ç”¨ `screen` æˆ– `tmux`

`screen` æˆ– `tmux` å…è®¸æ‚¨åˆ›å»ºä¸€ä¸ª**è™šæ‹Ÿç»ˆç«¯ä¼šè¯**ã€‚æ‚¨å¯ä»¥éšæ—¶åˆ†ç¦» (Detach) ä¼šè¯å¹¶æ–­å¼€ SSH è¿æ¥ï¼Œä¼šè¯ä¸­çš„ç¨‹åºä¼šç»§ç»­è¿è¡Œã€‚

- **å¯åŠ¨æ­¥éª¤ï¼š**
  1. åˆ›å»ºä¼šè¯ï¼š`screen -S my_app_session` æˆ– `tmux new -s my_app_session`
  2. åœ¨ä¼šè¯ä¸­å¯åŠ¨ç¨‹åºï¼ˆå‰å°ï¼‰ï¼š`java -jar your_application.jar`
  3. åˆ†ç¦»ä¼šè¯ï¼šæŒ‰ä¸‹ `Ctrl + A` ç„¶åæŒ‰ `D` (å¯¹äº `screen`)ï¼Œæˆ– `Ctrl + B` ç„¶åæŒ‰ `D` (å¯¹äº `tmux`)ã€‚
  4. é€€å‡º SSH è¿æ¥ã€‚
- **æ¢å¤æ­¥éª¤ï¼š**
  - `screen -r my_app_session` æˆ– `tmux attach -t my_app_session`
- **ä¼˜ç‚¹ï¼š** å¯ä»¥åœ¨ä»»æ„æ—¶é—´ç‚¹é‡æ–°è¿æ¥å¹¶æŸ¥çœ‹å®æ—¶è¾“å‡ºã€è¾“å…¥å‘½ä»¤ï¼Œæ˜¯äº¤äº’å¼åå°è¿è¡Œçš„æœ€ä½³é€‰æ‹©ã€‚

### æ–¹å¼ä¸‰ï¼šä½¿ç”¨ Systemd æœåŠ¡ç®¡ç†ï¼ˆæœ€ä½³å®è·µï¼‰

å¯¹äºæ­£å¼çš„ç”Ÿäº§ç¯å¢ƒï¼Œæœ€ä½³å®è·µæ˜¯åˆ›å»º Linux **Systemd Service** æ–‡ä»¶ã€‚è¿™æ ·å°±å¯ä»¥ä½¿ç”¨ `systemctl` å‘½ä»¤åƒç®¡ç† Nginxã€Apache ä¸€æ ·ç®¡ç†æ‚¨çš„ Java åº”ç”¨ã€‚

#### 1. åˆ›å»º Service æ–‡ä»¶

åœ¨ `/etc/systemd/system/` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œä¾‹å¦‚ `my-app.service`ï¼š

Ini, TOML

```
[Unit]
Description=My Spring Boot Application
After=network.target

[Service]
# ç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼Œä»¥é root ç”¨æˆ·è¿è¡Œæ˜¯æœ€ä½³å®è·µ
User=app_user
Group=app_group
# åº”ç”¨ç¨‹åºçš„å·¥ä½œç›®å½•
WorkingDirectory=/opt/apps/my-app
# ç¨‹åºçš„å¯åŠ¨å‘½ä»¤ï¼Œä½¿ç”¨ç»å¯¹è·¯å¾„
ExecStart=/usr/bin/java -Xms128m -Xmx512m -jar /opt/apps/my-app/your_application.jar
# è‡ªåŠ¨é‡å¯è®¾ç½®
Restart=always
# é‡å¯ç­‰å¾…æ—¶é—´
RestartSec=10
# æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯è¾“å‡ºéƒ½é‡å®šå‘åˆ°ç³»ç»Ÿæ—¥å¿—
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
```

#### 2. ç®¡ç†æœåŠ¡

- **é‡è½½é…ç½®ï¼š**

  Bash

  ```
  sudo systemctl daemon-reload
  ```

- **å¯åŠ¨æœåŠ¡ï¼š**

  Bash

  ```
  sudo systemctl start my-app
  ```

- **æŸ¥çœ‹çŠ¶æ€ï¼š**

  Bash

  ```
  sudo systemctl status my-app
  ```

- **è®¾ç½®å¼€æœºè‡ªå¯ï¼š**

  Bash

  ```
  sudo systemctl enable my-app
  ```

- **æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼š**

  Bash

  ```
  sudo journalctl -u my-app -f
  ```

### å¸¸ç”¨ JVM å¯åŠ¨å‚æ•°

æ— è®ºæ‚¨ä½¿ç”¨å“ªç§æ–¹å¼å¯åŠ¨ï¼Œéƒ½å¯ä»¥æ·»åŠ  JVM å‚æ•°æ¥ä¼˜åŒ–æ€§èƒ½æˆ–è¿›è¡Œè°ƒè¯•ï¼š

| **å‚æ•°**              | **ä½œç”¨**         | **ç¤ºä¾‹**                                    |
| --------------------- | ---------------- | ------------------------------------------- |
| `-Xms`                | åˆå§‹å †å¤§å°       | `-Xms512m` (åˆå§‹åˆ†é… 512MB å†…å­˜)            |
| `-Xmx`                | æœ€å¤§å †å¤§å°       | `-Xmx2048m` (æœ€å¤§ä½¿ç”¨ 2GB å†…å­˜)             |
| `-D`                  | è®¾ç½®ç³»ç»Ÿå±æ€§     | `-Dserver.port=8081` (è¦†ç›–åº”ç”¨é…ç½®ä¸­çš„ç«¯å£) |
| `-XX:+PrintGCDetails` | æ‰“å°è¯¦ç»† GC æ—¥å¿— | `-XX:+PrintGCDetails -Xloggc:gc.log`        |

æ‚¨å¸Œæœ›æˆ‘è¿›ä¸€æ­¥è®²è§£å¦‚ä½•**æ ¹æ®åº”ç”¨çš„å†…å­˜éœ€æ±‚é€‰æ‹© `-Xms` å’Œ `-Xmx`** å‚æ•°å—ï¼Ÿ